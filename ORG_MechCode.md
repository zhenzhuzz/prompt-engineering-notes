# MechCode: 程序员的机械设计工具

**版本**: v1.1.0
**文档类型**: ORG 文档（Organization-level Product Introduction）
**创建日期**: 2025-12-08
**最后更新**: 2025-12-09
**目标读者**: 软件工程师、创客、机器人工程师、硬件创业者

**文档目的**: 本文档用于介绍 MechCode 的产品定位和核心价值，
帮助程序员理解"用代码设计机械零件"的全新工作方式。

---

## 📑 目录

- [1. 产品定义](#1-产品定义)
- [2. 核心设计原则](#2-核心设计原则)
- [3. 产品结构与组成](#3-产品结构与组成)
- [4. 用户体验流程](#4-用户体验流程)
- [5. 产品定位与价值](#5-产品定位与价值)

---

## 1. 产品定义

### 1.1 一句话定义

> **MechCode** 是面向程序员的机械设计工具，让开发者用代码和自然语言设计 3D 机械零件，无需学习传统 CAD 软件。

### 1.2 核心特征

| 特征 | 说明 | 独特价值 |
|------|------|----------|
| **代码驱动** | 用 .mech 文件定义零件，支持 Git 版本控制 | 像管理代码一样管理设计 |
| **自然语言** | 用文字描述需求，AI 自动生成设计文件 | 零学习曲线 |
| **双向能力** | 正向生成（文字→模型）+ 逆向工程（照片→模型） | 覆盖全场景 |
| **参数化** | 所有尺寸都是变量，修改一处自动更新 | 快速迭代 |
| **工业标准** | 输出 STEP/STL 格式，兼容所有制造商 | 无厂商锁定 |

### 1.3 目标用户

| 用户群体 | 典型场景 | 为什么选择 MechCode |
|----------|----------|---------------------|
| **软件工程师** | 做机器人/硬件副项目 | 不想花时间学 SolidWorks |
| **创客/爱好者** | 3D 打印自定义零件 | CAD 软件太复杂 |
| **机器人工程师** | 快速迭代机架和支架 | 需要代码级别的控制 |
| **硬件创业团队** | 快速原型机械零件 | 团队主要是程序员 |

### 1.4 解决的核心问题

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      程序员做硬件的困境                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  你是一个软件工程师，想做一个机器人项目。                                  │
│                                                                          │
│  传统方式：学习 SolidWorks                                                │
│  ├── 成本：每年 4000 美元授权费                                          │
│  ├── 时间：2-4 周学习基础操作                                            │
│  ├── 痛点：鼠标点击式操作，没有版本控制                                   │
│  └── 结果：还是很慢，很挫败，不是你的工作流                               │
│                                                                          │
│  MechCode 方式：                                                         │
│  ├── 成本：免费开源                                                      │
│  ├── 时间：10 分钟安装，直接开始设计                                     │
│  ├── 流程：描述需求 → 预览 → 导出 → 3D 打印                              │
│  └── 结果：感觉像写代码一样自然                                          │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 2. 核心设计原则

### 2.1 原则 #1: 代码即设计

**核心理念**: 设计文件应该是人类可读的文本，而不是不透明的二进制文件。

**具体体现**:
- 使用 .mech 文件格式（基于 YAML）
- 支持 Git diff、merge、blame
- 所有尺寸定义为参数变量

**对比**:

| 维度 | 传统 CAD | MechCode |
|------|----------|----------|
| 文件格式 | 二进制 (.sldprt) | 文本 (.mech) |
| 版本控制 | 无法 diff | 完美支持 Git |
| 历史追溯 | 手动备份 | git blame |
| 协作方式 | 文件传递 | Pull Request |

### 2.2 原则 #2: AI 原生设计

**核心理念**: AI 不是辅助功能，而是核心交互方式。

**具体体现**:
- 自然语言输入：描述你想要的零件
- AI 理解工程意图，不只是几何形状
- 通过对话迭代优化设计

**用户体验**:

```
用户: "我需要一个 NEMA 17 电机的安装支架"
        │
        ▼
MechCode AI 理解:
• NEMA 17 = 42.3mm x 42.3mm 面板
• 安装孔 = 31mm 间距，M3 螺丝
• 轴孔 = 5mm 直径
        │
        ▼
自动生成带正确尺寸的参数化 .mech 文件
        │
        ▼
用户: "把厚度加到 8mm，增加刚性"
        │
        ▼
更新参数，重新生成模型
```

### 2.3 原则 #3: 双向能力

**核心理念**: 不仅能从描述生成模型，还能从照片逆向生成。

**两个方向**:

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           双向设计能力                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  正向生成 (Forward)                                                      │
│  ─────────────────                                                       │
│  "12 齿齿轮，模数 2"  ──▶  .mech 文件  ──▶  STEP/STL                    │
│                                                                          │
│  应用场景:                                                               │
│  • 从零开始设计新零件                                                    │
│  • 快速原型迭代                                                          │
│  • 批量生成系列零件                                                      │
│                                                                          │
│  ─────────────────────────────────────────────────────────────────────  │
│                                                                          │
│  逆向工程 (Reverse)                                                      │
│  ─────────────────                                                       │
│  零件照片  ──▶  视觉 AI 分析  ──▶  .mech 文件  ──▶  STEP                │
│                                                                          │
│  应用场景:                                                               │
│  • 复制损坏的零件                                                        │
│  • 数字化老旧部件                                                        │
│  • 从草图快速建模                                                        │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 2.4 原则 #4: 程序员优先体验

**核心理念**: 界面和工作流专为程序员设计，不是传统 CAD 用户。

**具体体现**:
- 命令行优先：所有操作都可以通过 CLI 完成
- Python API：可编程调用，集成到自动化流程
- IDE 友好：.mech 文件可以在任何文本编辑器中编辑
- 无需 GUI：不强制使用图形界面

### 2.5 原则 #5: 面向制造的设计 (DFM/DFA)

**核心理念**: 设计不仅要"画出来"，还要"能做出来、能装起来"。

**问题背景**:

> **真实场景**: 机械工程师在装配网球发球机时，因为走线问题，经常要拆掉一部分零件重新布线，然后再装上。这是机电一体化产品开发中的常见痛点。

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    机电一体化产品的隐藏成本                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  传统工作流的问题:                                                        │
│  ─────────────────                                                       │
│  1. 设计阶段: 零件设计 ✓  →  装配设计 ✓  →  走线设计 ❌ (往往被忽略)     │
│                                                                          │
│  2. 原型阶段: 3D打印/激光切割 → 装配 → 发现走线冲突 → 拆开 → 重来       │
│              └───────────────── 重复 3-5 次 ────────────────┘            │
│                                                                          │
│  3. 公差问题: M3 螺纹孔设计 3.0mm → 3D打印后实际 2.8mm → 螺栓装不进去   │
│              需要手动扩孔或重新打印                                       │
│                                                                          │
│  隐藏成本:                                                               │
│  • 时间: 每次装配迭代 2-4 小时                                           │
│  • 材料: 重新打印/切割的浪费                                             │
│  • 挫败感: "明明设计好了，为什么装不上？"                                │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

**MechCode 的解决方案**:

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    MechCode v2: 机电装配辅助                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌──────────────────┐     ┌──────────────────┐     ┌──────────────────┐ │
│  │  1. 公差补偿      │     │  2. 材质感知      │     │  3. 线缆路径    │ │
│  │  ──────────────  │     │  ──────────────  │     │  ──────────────  │ │
│  │                  │     │                  │     │                  │ │
│  │  输入:           │     │  输入:           │     │  输入:           │ │
│  │  "M3螺纹孔"      │     │  "树脂3D打印"    │     │  "从电机到控制板"│ │
│  │  "3D打印树脂"    │     │  "5mm厚度"       │     │  "避开热源"      │ │
│  │                  │     │                  │     │                  │ │
│  │  输出:           │     │  输出:           │     │  输出:           │ │
│  │  "建议孔径3.3mm" │     │  "预计形变0.2mm" │     │  "推荐路径+固定点"│ │
│  │  "过盈配合加0.1" │     │  "建议加强筋"    │     │  "最小弯曲半径"  │ │
│  └──────────────────┘     └──────────────────┘     └──────────────────┘ │
│           │                       │                       │             │
│           └───────────────────────┼───────────────────────┘             │
│                                   ▼                                      │
│                    ┌──────────────────────────┐                          │
│                    │  4. AI 装配顺序优化       │                          │
│                    │  ────────────────────    │                          │
│                    │                          │                          │
│                    │  分析装配体 + 维护需求    │                          │
│                    │  生成最优装配步骤         │                          │
│                    │  "先装线缆 → 再装盖板"    │                          │
│                    │  "预留维护开口"           │                          │
│                    │                          │                          │
│                    └──────────────────────────┘                          │
│                                                                          │
│  💡 核心价值: 在设计阶段就解决装配问题，而不是原型阶段反复试错           │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

**四个核心能力**:

| 能力 | 功能 | 输入 | 输出 |
|------|------|------|------|
| **公差补偿** | 根据制造工艺自动调整尺寸 | "M3孔, 3D打印" | 建议孔径 3.3-3.5mm |
| **材质形变预测** | 简化 FEA，预测塑料/树脂形变 | 材质 + 厚度 + 载荷 | 形变量 + 加强建议 |
| **AI 走线推荐** | 自动规划线缆路径 | 起点 + 终点 + 约束 | 路径 + 固定点 + 弯曲半径 |
| **装配顺序优化** | 生成最优装配步骤 | 装配体 + 维护需求 | 装配步骤 + 可维护性评分 |

**为什么现有工具没有解决这个问题**:

| 工具 | 定价 | 目标用户 | 问题 |
|------|------|----------|------|
| [Siemens NX + Capital](https://plm.sw.siemens.com/en-US/nx/cad-online/ecad-software/wire-harness-design/) | $$$$$ | 汽车/航空企业 | 太贵、太复杂 |
| [EPLAN Harness proD](https://www.eplan.com/us-en/products/eplan-harness-prod/) | $$$$$ | 工业设备企业 | 需要专业培训 |
| [IPS Cable Simulation](https://flexstructures.com/products/ips-cable-simulation/) | $$$$$ | 大型制造商 | 完整 FEA，计算慢 |
| [Synera](https://www.synera.io/) | $$$$$ | 企业研发 | 自动化很好，但太专业 |
| **MechCode** | **免费** | **程序员/创客** | **轻量级，自然语言输入** |

**市场空白**: 消费级/创客级完全没有这类工具，MechCode 可以填补。

---

## 3. 产品结构与组成

### 3.1 整体架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        MechCode 产品架构                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  用户接口层                                                              │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │   命令行 (CLI)      │     Python API      │    VS Code 插件     │   │
│  │   mechcode gen      │   import mechcode   │     (规划中)        │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                │                                        │
│                                ▼                                        │
│  核心引擎层                                                              │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                  │   │
│  │   ┌────────────────┐        ┌────────────────┐                  │   │
│  │   │   正向生成      │        │   逆向工程      │                  │   │
│  │   │  (文字→CAD)    │        │  (图片→CAD)    │                  │   │
│  │   └────────────────┘        └────────────────┘                  │   │
│  │            │                        │                            │   │
│  │            └──────────┬─────────────┘                            │   │
│  │                       ▼                                          │   │
│  │            ┌────────────────────┐                                │   │
│  │            │   .mech 文件解析    │                                │   │
│  │            │     与生成器        │                                │   │
│  │            └────────────────────┘                                │   │
│  │                       │                                          │   │
│  │                       ▼                                          │   │
│  │            ┌────────────────────┐                                │   │
│  │            │   CAD 内核执行      │                                │   │
│  │            │   (CadQuery)       │                                │   │
│  │            └────────────────────┘                                │   │
│  │                       │                                          │   │
│  └───────────────────────┼──────────────────────────────────────────┘   │
│                          ▼                                              │
│  输出: STEP, STL, OBJ, GLTF                                             │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 核心模块说明

| 模块 | 功能 | 关键能力 |
|------|------|----------|
| **命令行 (CLI)** | 用户主要交互入口 | gen、build、validate、info 命令 |
| **Python API** | 编程接口 | 可集成到自动化脚本和工作流 |
| **正向生成** | 自然语言转 CAD | 模板匹配 + LLM 生成 |
| **逆向工程** | 图片转参数化模型 | 视觉 AI 分析 + 尺寸估计 |
| **.mech 解析器** | 文件格式处理 | 解析、验证、执行 .mech 文件 |
| **零件库** | 预置常用零件 | 齿轮、支架、法兰、外壳等 |

### 3.3 数据流向

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           数据流向图                                      │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  输入方式（四选一）:                                                      │
│  ─────────────────                                                       │
│  1. 自然语言描述     "设计一个 12 齿齿轮"                                 │
│  2. .mech 文件       gear.mech (YAML 参数化)                             │
│  3. Python API       mechcode.parts.gear(teeth=12)                       │
│  4. 零件照片         photo.jpg → 逆向工程                                │
│                                                                          │
│          │              │              │              │                  │
│          ▼              ▼              ▼              ▼                  │
│     ┌─────────────────────────────────────────────────────────┐         │
│     │              .mech 中间表示                               │         │
│     │           (所有输入统一转换为 .mech)                      │         │
│     └─────────────────────────────────────────────────────────┘         │
│                              │                                           │
│                              ▼                                           │
│     ┌─────────────────────────────────────────────────────────┐         │
│     │               CAD 内核执行                                │         │
│     │            (生成 B-rep 几何体)                            │         │
│     └─────────────────────────────────────────────────────────┘         │
│                              │                                           │
│          ┌──────────────────┼──────────────────┐                        │
│          ▼                  ▼                  ▼                        │
│       STEP 文件          STL 文件           预览视图                     │
│      (精密制造)         (3D 打印)          (Web 查看)                    │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 4. 用户体验流程

### 4.1 核心用户旅程

**场景**: 软件工程师想为机器人项目设计一个电机支架

```
步骤 1: 安装 MechCode
        用户在终端执行安装命令
        30 秒内完成安装

步骤 2: 描述需求
        用户输入: "NEMA 17 电机安装支架，带 4 个固定孔"
        MechCode 识别标准规格，生成 motor_mount.mech 文件

步骤 3: 查看和调整
        用户用任意编辑器打开 .mech 文件
        修改厚度参数: thickness: 5 → thickness: 8

步骤 4: 构建模型
        执行构建命令，生成 STEP 文件
        几秒内完成

步骤 5: 版本控制
        将 .mech 文件加入 Git 仓库
        与代码一起管理版本

步骤 6: 制造
        将 STEP 文件发送给 CNC 加工商
        或导出 STL 用于 3D 打印
```

### 4.2 场景 1: 正向生成（文字→CAD）

**用户背景**: 需要一个传动齿轮

**体验流程**:

```
1. 用户描述需求
   输入: "24 齿直齿轮，模数 1.5，8mm 厚，中心孔 6mm"

2. MechCode 解析意图
   识别零件类型: 直齿渐开线齿轮
   提取参数: 齿数=24, 模数=1.5, 厚度=8, 孔径=6

3. 生成 .mech 文件
   创建参数化设计文件
   包含自动计算的派生尺寸（节圆直径、齿顶圆等）

4. 用户确认或修改
   查看参数是否正确
   可以直接编辑 .mech 文件调整

5. 构建输出
   执行构建命令
   生成可制造的 STEP 文件
```

**关键价值**: 用户无需了解齿轮设计公式，只需描述需求

### 4.3 场景 2: 逆向工程（图片→CAD）

**用户背景**: 有一个损坏的塑料支架，需要复制一个

**体验流程**:

```
1. 拍摄照片
   用户拍摄零件照片
   建议: 放置参照物（硬币/尺子）用于估算尺寸

2. 上传分析
   执行逆向命令，指定图片路径
   视觉 AI 开始分析

3. AI 识别结果
   识别零件类型: L 型支架
   估算尺寸: 长度约 80mm，高度约 50mm，厚度约 5mm
   置信度: 75%

4. 生成 .mech 文件
   创建参数化设计文件
   标注: "尺寸为估计值，请验证后再制造"

5. 用户校准
   用户测量实际零件
   修正 .mech 文件中的参数

6. 构建输出
   生成 STEP 文件
   3D 打印或加工
```

**关键价值**: 快速获得可编辑的参数化模型，而不是死板的网格

### 4.4 典型使用场景汇总

| 场景 | 输入 | 输出 | 耗时 |
|------|------|------|------|
| 设计齿轮 | "12 齿齿轮，模数 2" | gear.step | 几秒 |
| 设计支架 | "L 型支架 100x60mm" | bracket.step | 几秒 |
| 复制零件 | 零件照片 | part.mech + part.step | 1-2 分钟 |
| 批量变体 | 参数化 .mech 文件 | 10 个不同尺寸的 STEP | 几秒 |

### 4.5 场景 3: 机电装配辅助

**用户背景**: 机器人工程师正在装配一台网球发球机，需要规划线缆走线

**体验流程**:

```
1. 用户描述走线需求
   输入: "从 NEMA 17 电机到 Arduino 控制板，避开发热区域，线缆直径 5mm"

2. MechCode 分析装配体
   识别: 起点（电机接线端）、终点（控制板）、障碍物、热源位置
   约束: 最小弯曲半径 = 6×线径 = 30mm

3. AI 生成走线方案
   输出:
   • 推荐路径（3D 曲线）
   • 固定点位置（每 80mm 一个卡扣）
   • 预留长度（+15% 余量）

4. 生成装配指导
   输出:
   • "步骤 1: 先安装线缆固定卡扣到底板"
   • "步骤 2: 穿线并固定到卡扣"
   • "步骤 3: 安装电机（此时线缆已就位）"
   • "步骤 4: 安装侧板盖"

5. 公差补偿
   自动调整:
   • M3 安装孔: 3.0mm → 3.3mm (3D 打印树脂)
   • 卡扣配合: +0.2mm 间隙补偿
```

**关键价值**: 在设计阶段预见装配问题，避免原型阶段反复拆装

### 4.6 场景 4: 制造公差自动补偿

**用户背景**: 创客准备用 3D 打印树脂制作零件，需要确保螺栓能装上

**体验流程**:

```
1. 用户指定制造工艺
   输入: "制造方式: SLA 树脂 3D 打印"

2. 用户描述孔位
   输入: "4 个 M3 通孔用于固定"

3. MechCode 自动补偿
   原始设计: 3.0mm 孔径
   补偿后: 3.3mm 孔径
   原因: SLA 打印孔收缩约 0.3mm

4. 输出带补偿的 .mech 文件
   参数自动调整，标注 "已针对 SLA 打印优化"

5. 用户可查看补偿逻辑
   显示: "M3 通孔 SLA 补偿规则: +0.3mm (来源: 制造经验库)"
```

**关键价值**: 无需记忆各种制造工艺的公差规则，AI 自动处理

---

## 5. 产品定位与价值

### 5.1 与传统 CAD 的区别

| 维度 | 传统 CAD (SolidWorks) | MechCode |
|------|----------------------|----------|
| **目标用户** | 专业机械工程师 | 程序员/创客 |
| **学习曲线** | 陡峭（周/月） | 平缓（分钟） |
| **交互方式** | 鼠标点击 GUI | 命令行 + 代码 |
| **文件格式** | 二进制专有 | 文本开放 |
| **版本控制** | 困难 | 原生支持 Git |
| **自动化** | 有限 | 完全可编程 |
| **AI 集成** | 后期添加 | 核心能力 |
| **价格** | 昂贵 ($4000+/年) | 免费开源 |

### 5.2 不适用场景

MechCode **不是** 传统 CAD 的替代品，以下场景应使用专业 CAD：

- 复杂装配体（上千个零件）
- 需要详细工程图纸（GD&T 标注）
- 有限元分析（FEA/CFD）
- 专业制造工艺规划

MechCode 适合：简单到中等复杂度的零件快速设计

### 5.3 核心价值总结

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      MechCode 核心价值                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  对程序员的价值:                                                          │
│  ──────────────                                                          │
│  1. 零学习曲线                                                           │
│     你已经会: Python、YAML、CLI、Git                                     │
│     这就是 MechCode 需要的全部技能                                       │
│                                                                          │
│  2. 代码级控制                                                           │
│     参数化设计（函数带参数）                                              │
│     版本控制（Git diff 你的设计）                                        │
│     自动化（CI/CD 生成机械零件）                                         │
│                                                                          │
│  3. AI 辅助                                                              │
│     自然语言 → 3D 模型                                                   │
│     照片 → 参数化代码                                                    │
│     像 Copilot，但用于 CAD                                               │
│                                                                          │
│  4. 工业标准输出                                                         │
│     STEP 文件兼容所有制造商                                              │
│     STL 用于 3D 打印                                                     │
│     无厂商锁定                                                           │
│                                                                          │
│  ────────────────────────────────────────────────────────────────────   │
│                                                                          │
│  最终结果:                                                               │
│  从想法到可制造零件只需几分钟，而不是几天。                               │
│  无需学习新软件。                                                        │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 📂 相关文档

- [ORG_MechFormat.md](./ORG_MechFormat.md) - .mech 文件格式规范
- [examples/](../examples/) - 示例 .mech 文件

---

**文档维护**: MechCode 团队
**最后更新**: 2025-12-08
