---
id: CARD-20251222-0009
type: tech_blog
status: draft
created_at: 2025-12-22
last_verified_at: 2025-12-22
confidence: medium
scope: "Kafka vs RabbitMQ 选型启发式规则；依赖具体工作负载、团队运维能力、消息语义需求；数值阈值为参考量级而非绝对标准"
tags:
  - learning
  - backend
  - kafka
  - rabbitmq
  - message-queue
  - decision-boundary
  - heuristic
sensitivity: public
evidence_refs:
  - EVI-20251222-0005#loc:findings.kafka-vs-rabbitmq
  - EVI-20251222-0005#loc:findings.kafka-vs-rabbitmq.architecture
  - EVI-20251222-0005#loc:findings.kafka-vs-rabbitmq.performance
sources:
  - https://aws.amazon.com/compare/the-difference-between-rabbitmq-and-kafka/
  - https://www.cloudamqp.com/blog/when-to-use-rabbitmq-or-apache-kafka.html
---

## Claim

Kafka 和 RabbitMQ 的核心差异在于设计目标：Kafka 是分布式流平台（高吞吐、事件持久化、可重放），RabbitMQ 是消息代理（灵活路由、消息优先级、ACK 后删除）。选型决策应基于是否需要"事件回溯"和"高吞吐"（例如 10 万+/秒量级，具体阈值因硬件和配置而异）。

## Evidence

根据 EVI-20251222-0005#loc:findings.kafka-vs-rabbitmq：

**架构差异**：
- Kafka 使用 topics/partitions，消息持久化到磁盘，消费者主动拉取，可重放
- RabbitMQ 使用 exchanges/queues/bindings，消息 ACK 后删除，支持复杂路由和优先级

**性能差异**：
- Kafka：百万级/秒（顺序磁盘 I/O），水平扩展
- RabbitMQ：数千~万/秒，垂直扩展优先

**2024-2025 更新**：
- Kafka KRaft 模式移除 ZooKeeper 依赖，运维复杂度下降
- RabbitMQ Quorum Queues 增强可靠性

**Assumptions / Caveats（假设与注意事项）**：
- 吞吐量数值（如"百万级/秒"）是典型基准测试结果，实际取决于消息大小、分区数、硬件配置、网络带宽
- 消息顺序性：Kafka 仅保证分区内有序，RabbitMQ 可保证队列内有序
- 持久化需求：若消息必须可重放/审计，Kafka 更适合；若消息处理后即弃，RabbitMQ 更简单
- 运维复杂度：Kafka 集群运维（即使 KRaft 后）仍比单机 RabbitMQ 复杂
- 团队经验：熟悉哪个生态系统也是重要决策因素

## Transferable Rule

**选型决策清单（5 步）：**

```
Step 1: 确认消息语义
        □ 需要消费后重放/回溯？ → 倾向 Kafka
        □ 消费即删除、无需回溯？ → 倾向 RabbitMQ

Step 2: 评估吞吐量级
        □ 预估峰值 > 10 万条/秒（启发式阈值）？ → 倾向 Kafka
        □ 预估峰值 < 1 万条/秒？ → RabbitMQ 通常够用

Step 3: 检查路由复杂度
        □ 需要条件路由/优先级队列？ → 倾向 RabbitMQ
        □ 简单 pub/sub 或日志流？ → Kafka 更自然

Step 4: 评估运维能力
        □ 团队有分布式系统运维经验？ → Kafka 可接受
        □ 偏好低运维复杂度？ → RabbitMQ 更友好

Step 5: 不确定时 → 原型验证
        □ 用真实工作负载做小规模 benchmark
        □ 测量延迟、吞吐、资源消耗后再决策
```

**快速判断**：问"消息消费后还需要吗？"——需要重放选 Kafka，不需要选 RabbitMQ。

**护栏**：若决策依据不清晰，先用小规模原型测量，不要凭直觉选择。
