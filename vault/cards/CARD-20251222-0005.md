---
id: CARD-20251222-0005
type: debug_playbook
status: validated
created_at: 2025-12-22
last_verified_at: 2025-12-22
confidence: high
scope: "多 Agent 并发修改同一文件时的作用域控制"
tags:
  - debug
  - multi-agent
  - collaboration
  - scope-reduction
sensitivity: public
evidence_refs:
  - EVI-20251222-0003#loc:fix
sources: []
---

## Claim

当多个 Agent 需要修改同一文件时，必须优先使用 Edit（局部修改）而非 Write（全文件重写），并按文件类型区分所有权：制度文件单写多读，资产文件多写可合并。

## Evidence

根据 EVI-20251222-0003#loc:fix：竞态条件的根因是作用域过大（全文件重写）和缺乏所有权协商。

关键规则：
- Edit 工具保留未修改部分，Write 工具覆盖全文件
- 制度文件（schema/validator/governance）同一时间只允许一个 agent 修改
- 资产文件（evidence/cards）以 Card 为最小并发单元

## Transferable Rule

**缩小作用域 + 区分所有权。** 多 Agent 协作时：(1) 优先 Edit 不优先 Write；(2) 制度文件串行修改，资产文件可并行新增。诊断信号：若发现文件内容被意外覆盖，检查是否有 agent 使用了 Write 全文件重写。
