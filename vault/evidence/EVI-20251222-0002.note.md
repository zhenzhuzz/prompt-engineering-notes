# Git Bash 路径翻译陷阱调试笔记

## Environment

- **OS**: Windows 11 (MSYS_NT-10.0)
- **Shell**: Git Bash (MSYS2-based)
- **Encoding**: UTF-8
- **Project**: auto-research 自动化脚本
- **Tool versions**: Python 3.x (Windows native), Claude CLI

## Symptom

Bash 脚本调用 `python.exe` 读取临时文件时报 `FileNotFoundError`：

```
FileNotFoundError: [Errno 2] No such file or directory: '/tmp/tmp.yyN5K1HjaL'
```

困惑点：同一个 shell 会话中，`claude` 命令能写入 `/tmp/`，但 Python 读不到。

## Reproduction Steps

1. 在 Git Bash 中运行脚本
2. 脚本用 `mktemp` 创建临时文件 → 返回 `/tmp/tmp.xxx`
3. Claude CLI 写入该临时文件（成功）
4. Python 尝试读取该路径（失败）

```bash
local temp_result=$(mktemp)          # → /tmp/tmp.yyN5K1HjaL
claude -p "$prompt" > "$temp_result" # ✓ 成功
python -c "open('$temp_result', 'r')" # ✗ FileNotFoundError
```

## Expected vs Actual

- **Expected**: Python 能读取 `/tmp/tmp.xxx` 文件
- **Actual**: Python 报 FileNotFoundError

## Root Cause

MSYS2 的 `/tmp/` 是虚拟路径，仅 MSYS2 运行时程序（bash、git、claude）能识别。Windows 原生程序（python.exe）不知道 `/tmp/` 映射到 `C:\Users\...\AppData\Local\Temp\`。

```
MSYS2 程序: /tmp/ → 自动映射到 Windows 真实路径
Windows 程序: /tmp/ → 字面量，找不到
```

## Fix

使用 `cygpath -m` 转换路径（-m = mixed mode，输出正斜杠）：

```bash
local win_path=$(cygpath -m "$temp_result")
python -c "open('$win_path', 'r')"  # ✓ 成功
```

注意：`cygpath -w` 输出反斜杠 `C:\Users\...`，在 Python 中会导致转义问题（`\U` 被解析为 unicode）。

## Prevention

封装路径转换函数，所有跨层调用必经此函数：

```bash
to_win_path() {
    if command -v cygpath &>/dev/null; then
        cygpath -m "$1"
    else
        echo "$1" | sed 's|^/\([a-zA-Z]\)/|\1:/|'
    fi
}

# 使用
local temp=$(mktemp)
local win_temp=$(to_win_path "$temp")
```

## Artifacts

- 原始知识文档: `_knowledge/KNOW_git-bash-windows-path-translation-trap.md`
- 脚本位置: `auto-research/_shared/research.sh`
