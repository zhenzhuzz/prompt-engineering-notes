# Web 调研：Kafka vs RabbitMQ + Kubernetes 适用范围

## Research Questions

1. **Kafka vs RabbitMQ**: 什么时候选 Kafka，什么时候选 RabbitMQ？核心差异、典型场景、取舍点。
2. **Kubernetes 适用边界**: K8s 解决什么问题？什么时候是 overkill？规模/复杂度的边界在哪里？

## Sources

| Source | URL | Trust Reason |
|--------|-----|--------------|
| AWS Docs | https://aws.amazon.com/compare/the-difference-between-rabbitmq-and-kafka/ | AWS 官方文档，中立供应商视角 |
| CloudAMQP Blog | https://www.cloudamqp.com/blog/when-to-use-rabbitmq-or-apache-kafka.html | RabbitMQ 托管服务商，深度技术博客 |
| CNCF Blog | https://www.cncf.io/blog/2024/12/13/reconsidering-kubernetes-deployments-when-operators-are-overkill/ | 云原生基金会官方博客，2024-12 发布 |
| Dev.to Article | https://dev.to/sakethkowtha/kubernetes-the-overblown-balloon-in-the-tech-playground-2a9k | 开发者社区实践反思 |

## Findings

### Kafka vs RabbitMQ

#### 架构差异
- **RabbitMQ**: 传统消息代理，使用 exchanges/queues/bindings 路由消息。像邮局，确保消息送达指定目的地。
- **Kafka**: 分布式流平台，使用 topics/partitions 组织消息。像图书馆，生产者发布，消费者主动拉取。

#### 性能特征
| 维度 | Kafka | RabbitMQ |
|------|-------|----------|
| 吞吐量 | 百万级/秒（顺序磁盘 I/O） | 数千~万/秒（需多 broker 扩展） |
| 扩展方式 | 水平扩展（加节点/分区） | 垂直扩展优先，水平扩展复杂 |
| 消息保留 | 按保留期持久化，可重放 | ACK 后删除 |
| 路由复杂度 | 简单，复杂路由需 Kafka Streams | 灵活（direct/topic/fanout/header） |
| 优先级队列 | 不支持 | 支持 |

#### 选择决策框架
**选 Kafka**:
- 需要事件流重放/回溯分析
- 吞吐量要求百万级/秒
- 数据需长期保留（审计、日志聚合）
- 水平扩展是核心需求

**选 RabbitMQ**:
- 需要灵活消息路由（条件分发）
- 需要消息优先级
- 传统请求-响应模式
- 运维复杂度要求低、规模中等

#### 2024-2025 更新
- Kafka 已全面采用 KRaft（移除 ZooKeeper 依赖），运维复杂度显著下降
- RabbitMQ Quorum Queues 增强了可靠性

### Kubernetes 适用边界

#### K8s 解决什么问题
- 容器编排：多容器部署、调度、伸缩
- 服务发现与负载均衡
- 滚动更新与回滚
- 自愈（Pod 重启、节点迁移）

#### 何时 K8s 是 overkill
**复杂度 vs 收益不匹配**:
- 小规模项目（单服务/少数服务）：Docker Compose 足够
- 简单 CRUD 应用：不需要复杂编排
- 早期创业项目：运维成本 > 收益

**资源约束**:
- 学习曲线陡峭（YAML、Pod/Node/Ingress 概念）
- 云端账单可能很高（auto-scaling 意外触发）
- 本地运行资源消耗大

**触发条件不满足**:
- 没有多服务/微服务架构需求
- 不需要精细伸缩控制
- 团队缺乏 K8s 运维经验

#### 何时需要 K8s
- 大规模系统（多服务、多团队协作）
- 需要精细的伸缩和调度策略
- 已有微服务架构，需统一编排
- 团队有 K8s 运维能力

#### 轻量替代方案
| 方案 | 适用场景 |
|------|----------|
| Docker Compose | 单机多容器、开发环境、中等规模 |
| K3s | 边缘计算、IoT、CI 环境（轻量 K8s） |
| Serverless | 无需管理基础设施、事件驱动 |
| Helm/ArgoCD | 简化 K8s 部署，避免自定义 Operator |

## Caveats

- Kafka KRaft 模式在 2024 才成为默认，早期文档可能仍提 ZooKeeper
- RabbitMQ vs Kafka 的选择也受团队经验影响，不仅是技术因素
- K8s overkill 的判断取决于团队规模和运维能力，同样规模的项目在不同团队可能有不同答案
